---
title: "Prompt Cacheï¼šAgent æˆæœ¬æ§åˆ¶çš„æ ¸å¿ƒçº¦æŸ"
date: 2026-01-17
draft: false
summary: "ä» KV Cache åˆ° Prompt Cache çš„è®¤çŸ¥è·ƒè¿ï¼šå‰ç¼€ç²¾ç¡®åŒ¹é…çš„é“å¾‹ã€Agent çš„ I/O 100:1 å¤±è¡¡ã€ä»¥åŠä¸ºä»€ä¹ˆ Cache-Safe æ˜¯ Client ä¾§å·¥ç¨‹è´£ä»»ã€‚"
description: "ä» KV Cache åˆ° Prompt Cache çš„è®¤çŸ¥è·ƒè¿ï¼šå‰ç¼€ç²¾ç¡®åŒ¹é…çš„é“å¾‹ã€Agent çš„ I/O 100:1 å¤±è¡¡ã€ä»¥åŠä¸ºä»€ä¹ˆ Cache-Safe æ˜¯ Client ä¾§å·¥ç¨‹è´£ä»»ã€‚"
tags: ["Prompt Caching", "KV Cache", "Agent", "LLM", "Cost Optimization"]
categories: ["AI Agent Engineering"]
series: ["Agent å·¥ç¨‹å¸ˆçš„ Prompt Caching"]
---

> ğŸ“Œ **æœ¬æ–‡æ˜¯ã€ŒAgent å·¥ç¨‹å¸ˆçš„ Prompt Cachingã€ç³»åˆ—çš„ç¬¬ 2/4 ç¯‡**ã€‚ç¬¬ä¸€ç¯‡è®² KV Cache åº•å±‚åŸç†ï¼Œç¬¬äºŒç¯‡è®² Prompt Cache æ ¸å¿ƒçº¦æŸï¼Œç¬¬ä¸‰ç¯‡è®²å®æˆ˜è¸©å‘ä¸è¡Œä¸šå…¨æ™¯ï¼Œç¬¬å››ç¯‡è®² Context Engineering æ¶æ„æ‰‹è‰ºã€‚

## ä» KV Cache åˆ° Prompt Cacheï¼šè®¤çŸ¥è·ƒè¿

ä¸Šä¸€ç¯‡æˆ‘ä»¬ææ¸…æ¥šäº† KV Cache çš„æœ¬è´¨â€”â€”**ç”¨æ˜¾å­˜æ¢è®¡ç®—**ï¼Œåœ¨å•æ¬¡è¯·æ±‚å†…ç¼“å­˜å·²ç®—è¿‡çš„ K/V çŸ©é˜µï¼Œé¿å…è‡ªå›å½’ç”Ÿæˆæ—¶çš„é‡å¤è®¡ç®—ã€‚

ä½†å¦‚æœä½ åªç†è§£åˆ°è¿™ä¸€å±‚ï¼Œä½ è¿˜åœç•™åœ¨"LLM å·¥ç¨‹"çš„è§†è§’ã€‚

**çœŸæ­£æ”¹å˜ Agent æ¶æ„å¸ˆæ€ç»´æ–¹å¼çš„ï¼Œæ˜¯ä¸‹é¢è¿™ä¸ªé—®é¢˜ï¼š**

> å¦‚æœç”¨æˆ·æ¯æ¬¡å¯¹è¯ï¼Œå‰é¢ 80% çš„ Prompt éƒ½ä¸€æ¨¡ä¸€æ ·ï¼ˆSystem Prompt + å·¥å…·å®šä¹‰ + å†å²å¯¹è¯ï¼‰ï¼Œå‡­ä»€ä¹ˆæ¯æ¬¡éƒ½è¦é‡æ–°ç®—ä¸€é Prefillï¼Ÿ

è¿™å°±æ˜¯ **Prompt Cacheï¼ˆå‰ç¼€ç¼“å­˜ï¼‰** è¦è§£å†³çš„é—®é¢˜ã€‚å®ƒæŠŠ KV Cache çš„æ€æƒ³ä»å•æ¬¡è¯·æ±‚æ‰©å±•åˆ°äº†è·¨è¯·æ±‚çš„ç»´åº¦ï¼š

> å¦‚æœä¸¤æ¬¡ API è°ƒç”¨çš„ prompt å…±äº«ç›¸åŒçš„å‰ç¼€ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨å¯ä»¥ç›´æ¥å¤ç”¨ç¬¬ä¸€æ¬¡ Prefill ç®—å‡ºæ¥çš„ KV Cacheï¼Œè·³è¿‡å‰ç¼€éƒ¨åˆ†çš„ Prefill è®¡ç®—ã€‚

### ä»"å•åœºè€ƒè¯•è‰ç¨¿çº¸"åˆ°"è·¨ç§‘ç›®å…¬å¼è¡¨"

å…ˆç”¨ä¸€ä¸ªç±»æ¯”å¸®ä½ å»ºç«‹ç›´è§‰ï¼š

**KV Cache** åƒæ˜¯è€ƒè¯•æ—¶çš„è‰ç¨¿çº¸ã€‚ä½ åœ¨è§£ä¸€é“å¤§é¢˜ï¼Œæ¯ç®—ä¸€æ­¥å°±æŠŠä¸­é—´ç»“æœè®°åœ¨è‰ç¨¿çº¸ä¸Šï¼Œä¸‹ä¸€æ­¥ç›´æ¥å¼•ç”¨ï¼Œä¸ç”¨ä»å¤´ç®—ã€‚ä½†è€ƒå®Œè¿™åœºè¯•ï¼Œè‰ç¨¿çº¸å°±æ‰”äº†ã€‚ä¸‹ä¸€åœºè€ƒè¯•ï¼Œå“ªæ€•é‡åˆ°ä¸€æ¨¡ä¸€æ ·çš„å‰å‡ æ­¥ï¼Œä½ è¿˜å¾—é‡æ–°ç®—ã€‚

**Prompt Cache** åƒæ˜¯è€ƒè¯•æ—¶å…è®¸å¸¦å…¥çš„å…¬å¼è¡¨ã€‚æ•°å­¦è€ƒå®Œï¼Œç‰©ç†è¿˜èƒ½ç”¨ã€‚åªè¦å…¬å¼è¡¨çš„å†…å®¹æ²¡å˜ï¼Œæ¯åœºè€ƒè¯•éƒ½å¯ä»¥ç›´æ¥å¼•ç”¨ï¼Œä¸ç”¨é‡æ–°æ¨å¯¼ã€‚

ç”¨æŠ€æœ¯è¯­è¨€è¯´ï¼š

| ç»´åº¦ | KV Cache | Prompt Cache |
|------|----------|--------------|
| ä½œç”¨èŒƒå›´ | å•æ¬¡è¯·æ±‚**å†…éƒ¨** | **è·¨è¯·æ±‚** |
| ç¼“å­˜ä»€ä¹ˆ | å½“å‰è¯·æ±‚ä¸­å·²ç”Ÿæˆ token çš„ K/V | ä¹‹å‰è¯·æ±‚ä¸­å·²è®¡ç®—çš„å‰ç¼€ K/V |
| çœçš„æ˜¯ä»€ä¹ˆ | Decode é˜¶æ®µçš„é‡å¤è®¡ç®— | **Prefill é˜¶æ®µ**çš„é‡å¤è®¡ç®— |
| å¯¹è°æœ‰ä»·å€¼ | æ‰€æœ‰ LLM æ¨ç† | **è¾“å…¥é‡å¤ç‡é«˜çš„åœºæ™¯**ï¼ˆAgentã€å¤šè½®å¯¹è¯ï¼‰ |

è¿™å¯¹ä»¥ä¸‹åœºæ™¯ç‰¹åˆ«æœ‰ä»·å€¼ï¼š

- **å¤šè½®å¯¹è¯**ï¼šæ¯è½®å¯¹è¯çš„ prompt éƒ½ä»¥ä¹‹å‰çš„å¯¹è¯å†å²ä½œä¸ºå‰ç¼€
- **ç›¸åŒ System Prompt**ï¼šåŒä¸€ä¸ªåº”ç”¨çš„æ‰€æœ‰è¯·æ±‚å…±äº«ç›¸åŒçš„ system prompt
- **Agent ç³»ç»Ÿ**ï¼šAgent æ¯ä¸€æ­¥çš„ prompt = ä¸Šä¸€æ­¥çš„ prompt + æ–°çš„ action/observation

è¿™æ„å‘³ç€ç¬¬äºŒæ¬¡è¯·æ±‚çš„ TTFTï¼ˆé¦–å­—å»¶è¿Ÿï¼‰ä¼šå¤§å¹…é™ä½â€”â€”å› ä¸ºå¤§éƒ¨åˆ† Prefill è®¡ç®—è¢«è·³è¿‡äº†ã€‚

---

## å‰ç¼€ç²¾ç¡®åŒ¹é…ï¼šä¸€æ¡é“å¾‹

Prompt Cache çš„åŒ¹é…è§„åˆ™æå…¶ä¸¥æ ¼ï¼š

> **å¿…é¡»ä»ç¬¬ä¸€ä¸ª token å¼€å§‹å®Œå…¨ä¸€è‡´ï¼Œä¸€ä¸ª token çš„å·®å¼‚å°±ä¼šå¯¼è‡´è¯¥ä½ç½®ä¹‹åçš„ cache å…¨éƒ¨å¤±æ•ˆã€‚**

```
è¯·æ±‚ 1: [System Prompt] [User: Hello]                â†’ æ—  cacheï¼Œå…¨éƒ¨è®¡ç®—
è¯·æ±‚ 2: [System Prompt] [User: Hello] [Assistant: Hi] [User: ä½ å¥½] â†’ [System Prompt][User: Hello] å‘½ä¸­ cache
è¯·æ±‚ 3: [Modified System Prompt] [User: Hello]       â†’ å®Œå…¨ missï¼Œç¬¬ä¸€ä¸ª token å°±ä¸ä¸€æ ·
```

è¿™ä¸æ˜¯"å¤§è‡´ç›¸ä¼¼å°±è¡Œ"çš„æ¨¡ç³ŠåŒ¹é…ï¼Œè€Œæ˜¯ **byte-level exact match**ã€‚è¿™æ¡çº¦æŸçœ‹ä¼¼ç®€å•ï¼Œä½†å®ƒå¯¹ Agent ç³»ç»Ÿçš„æ¶æ„è®¾è®¡äº§ç”Ÿäº†æ·±è¿œå½±å“â€”â€”å¦‚ä½•ç»„ç»‡ prompt ç»“æ„ã€å¦‚ä½•ç®¡ç†å·¥å…·åˆ—è¡¨ã€å¦‚ä½•æ›´æ–°çŠ¶æ€ã€å¦‚ä½•å‹ç¼©å†å²ï¼Œæ‰€æœ‰è¿™äº›è®¾è®¡å†³ç­–éƒ½å¿…é¡»å›´ç»•"ä¸ç ´åå‰ç¼€"è¿™æ¡é“å¾‹å±•å¼€ã€‚

### ç”¨ä¾‹å­ç†è§£å‰ç¼€åŒ¹é…çš„ä¸¥æ ¼æ€§

ç»§ç»­ç”¨ "Understanding KV Cache" çš„ä¾‹å­ã€‚å‡è®¾ç”¨æˆ·å‘äº†ä¸¤æ¬¡è¯·æ±‚ï¼š

```
è¯·æ±‚ 1: "Understanding KV Cache"
â†’ Prefill 4 ä¸ª token: ["Under", "standing", " KV", " Cache"]
â†’ KV Cache å†™å…¥: Kâ‚€Kâ‚Kâ‚‚Kâ‚ƒ / Vâ‚€Vâ‚Vâ‚‚Vâ‚ƒ

è¯·æ±‚ 2: "Understanding KV Cache is important because"
â†’ å‰ 4 ä¸ª token å’Œè¯·æ±‚ 1 å®Œå…¨ä¸€è‡´ â†’ å‘½ä¸­ Cacheï¼
â†’ åªéœ€ Prefill æ–°å¢çš„ 3 ä¸ª token: [" is", " important", " because"]
```

ä½†å¦‚æœè¯·æ±‚ 2 æœ‰ä¸€ä¸ªå¾®å°çš„æ‹¼å†™å˜åŒ–â€”â€”"UnderstandingKV"ï¼ˆå°‘äº†ç©ºæ ¼ï¼‰ï¼š

```
è¯·æ±‚ 2 (é”™è¯¯): "UnderstandingKV Cache is important because"
â†’ tokenizer åˆ‡åˆ†ç»“æœå®Œå…¨ä¸åŒ: ["Understanding", "KV", " Cache", " is", ...]
â†’ ç¬¬ä¸€ä¸ª token "Understanding" â‰  "Under" â†’ ä»ç¬¬ä¸€ä¸ªä½ç½®å°±ä¸åŒ¹é…
â†’ Cache å®Œå…¨ missï¼Œéœ€è¦å…¨é‡ Prefill
```

å³ä½¿äººçœ¼çœ‹èµ·æ¥"å‡ ä¹ä¸€æ ·"ï¼Œä¸€ä¸ªç©ºæ ¼çš„å·®å¼‚å°±å¯¼è‡´ tokenizer åˆ‡åˆ†å‡ºå®Œå…¨ä¸åŒçš„ token åºåˆ—ï¼ŒCache 100% missã€‚

è¿™ä¸ªä¾‹å­æ­ç¤ºäº†ä¸€ä¸ªæ›´æ·±å±‚çš„é—®é¢˜ï¼šåœ¨ Agent ç³»ç»Ÿä¸­ï¼ŒCache miss å¾€å¾€ä¸æ˜¯å› ä¸ºäººæ‰“é”™å­—ï¼Œè€Œæ˜¯ä»£ç å±‚é¢çš„éç¡®å®šæ€§ã€‚æ¯”å¦‚ JSON åºåˆ—åŒ–æ—¶ key çš„æ’åºä¸ä¸€è‡´ï¼š

```python
# è¯·æ±‚ 1: {"a": 1, "b": 2} â†’ æŸç»„ token åºåˆ—
# è¯·æ±‚ 2: {"b": 2, "a": 1} â†’ ä¸åŒçš„ token åºåˆ—
# è¯­ä¹‰å®Œå…¨ç›¸åŒï¼Œä½† Cache å®Œå…¨ miss
```

---

## ç»æµè´¦ï¼šä¸æ˜¯"çœä¸€ç‚¹"ï¼Œè€Œæ˜¯"èƒ½ä¸èƒ½ç”¨å¾—èµ·"

å¾ˆå¤šäººè§‰å¾— Prompt Cache å°±æ˜¯"çœç‚¹é’±"ã€‚ä¸å¯¹ã€‚åœ¨ Agent åœºæ™¯ä¸‹ï¼Œè¿™æ˜¯**èƒ½ä¸èƒ½ç”¨å¾—èµ·**çš„é—®é¢˜ã€‚

### Agent çš„ I/O æ¯”ä¾‹ä¸¥é‡å¤±è¡¡

æ™®é€šèŠå¤©åœºæ™¯ï¼Œç”¨æˆ·è¾“å…¥å’Œæ¨¡å‹è¾“å‡ºå·®ä¸å¤šé•¿ã€‚ä½† Agent ä¸ä¸€æ ·â€”â€”æ¯ä¸€æ­¥éƒ½è¦æŠŠå®Œæ•´çš„å¯¹è¯å†å²ï¼ˆSystem Prompt + å·¥å…·å®šä¹‰ + ä¹‹å‰æ‰€æœ‰çš„ action/observationï¼‰å…¨éƒ¨å‘ç»™æ¨¡å‹ï¼Œæ¨¡å‹åªè¾“å‡ºä¸€å°æ®µï¼ˆä¸€ä¸ªå·¥å…·è°ƒç”¨æˆ–ä¸€æ®µå›å¤ï¼‰ã€‚

Manus æŠ«éœ²è¿‡ä¸€ä¸ªæ•°æ®ï¼š**input : output â‰ˆ 100 : 1**ã€‚

å¦‚æœæ²¡æœ‰ Prompt Cacheï¼Œæ¯ä¸€æ­¥éƒ½è¦é‡æ–° Prefill æ‰€æœ‰å†å² tokenã€‚éšç€å¯¹è¯è½®æ¬¡å¢åŠ ï¼Œè¾“å…¥ token æ•°çº¿æ€§å¢é•¿ï¼Œä½†ä½ è¦ä¸º**æ¯ä¸€æ­¥**éƒ½ä»˜å…¨ä»·ã€‚æ€»æˆæœ¬ï¼Ÿ**äºŒæ¬¡æ–¹å¢é•¿**ã€‚

### ä¸‰å®¶çš„å®é™…æ•°æ®

| åœºæ™¯ | ä¸ç¼“å­˜ | ç¼“å­˜å | èŠ‚çº¦ |
|------|--------|--------|------|
| Claudeï¼ˆæ­£å¸¸ vs cached inputï¼‰ | $3/MTok | $0.30/MTok | **90%** |
| OpenAI GPT-5ï¼ˆæ­£å¸¸ vs cachedï¼‰ | $10/MTok | $2.50/MTok | **75%** |
| Claude Code å•ä»»åŠ¡ï¼ˆçº¦ 2M tokensï¼‰ | ~$6.00 | ~$1.15 | **81%** |

Claude Code å›¢é˜Ÿçš„ Thariq è¯´è¿‡ä¸€å¥è¢«å¹¿æ³›å¼•ç”¨çš„è¯ï¼š

> "Coding agents would be cost prohibitive without prompt caching."
> ï¼ˆæ²¡æœ‰ Prompt Cachingï¼Œç¼–ç¨‹ Agent åœ¨æˆæœ¬ä¸Šæ ¹æœ¬ä¸å¯è¡Œã€‚ï¼‰

### å»¶è¿ŸåŒæ ·å…³é”®

ä¸åªæ˜¯é’±çš„é—®é¢˜ã€‚å½“ä½ çš„ Agent ä¸€ä¸ªä»»åŠ¡è¦è·‘ 50 æ­¥ï¼Œæ¯æ­¥çš„ Prompt æœ‰ 150K+ tokensï¼ŒTTFT çš„ç´¯ç§¯æ•ˆåº”éå¸¸æ˜¾è‘—ã€‚

- OpenAI æ•°æ®ï¼š150K+ tokens æ—¶ï¼Œcached è¯·æ±‚ TTFT å¿« **67%**
- Manusï¼šæŠŠ KV cache hit rate è§†ä¸º "**the single most important metric**"ï¼ˆæœ€é‡è¦çš„å•ä¸€æŒ‡æ ‡ï¼‰
- Claude Code å›¢é˜Ÿï¼šCache å‘½ä¸­ç‡ä¸‹é™ â†’ å½“ä½œ**çº¿ä¸Šäº‹æ•…ï¼ˆSEVï¼‰**å¤„ç†

ä½ æ²¡çœ‹é”™ï¼ŒCache å‘½ä¸­ç‡æ‰äº†ï¼Œä¸æ˜¯å‘ä¸ªå‘Šè­¦ï¼Œæ˜¯å½“ SEV å¤„ç†ã€‚è¿™è¯´æ˜äº†ä»€ä¹ˆï¼Ÿè¯´æ˜åœ¨ç”Ÿäº§çº§ Agent ç³»ç»Ÿä¸­ï¼ŒPrompt Cache å·²ç»æ˜¯åŸºç¡€è®¾æ–½çº§åˆ«çš„ä¾èµ–ã€‚

---

## Cache çš„å­˜å‚¨ç®¡ç†ï¼šæœåŠ¡ç«¯çš„å¤æ‚å·¥ç¨‹

ç†è§£äº† Cache çš„æˆæœ¬å½±å“ä¹‹åï¼Œä¸€ä¸ªè‡ªç„¶çš„é—®é¢˜æ˜¯ï¼šè¿™äº› Cache åœ¨æœåŠ¡ç«¯æ˜¯æ€ä¹ˆç®¡ç†çš„ï¼Ÿ

### å¤šæ¡ç›®å…±å­˜ä¸ TTL æœºåˆ¶

Cache æ¡ç›®ä¸ä¼šåœ¨æ–°è¯·æ±‚åˆ°æ¥æ—¶è¢«è¦†ç›–ï¼Œè€Œæ˜¯å…±å­˜ã€‚Anthropic çš„ Cache TTLï¼ˆç”Ÿå­˜æ—¶é—´ï¼‰çº¦ä¸º 5 åˆ†é’Ÿï¼Œå‘½ä¸­ååˆ·æ–°ã€‚

åœ¨ Agent åœºæ™¯ä¸‹ï¼Œæ¯ä¸€æ­¥éƒ½äº§ç”Ÿä¸€ä¸ªæ–°çš„ï¼ˆæ›´é•¿çš„ï¼‰Cache æ¡ç›®ï¼š

```
Agent æ­¥éª¤ 1:  [System][Tools][Msg1]              â†’ Cache æ¡ç›® A
Agent æ­¥éª¤ 2:  [System][Tools][Msg1][Msg2]        â†’ Cache æ¡ç›® B (A ä»å­˜åœ¨)
Agent æ­¥éª¤ 3:  [System][Tools][Msg1][Msg2][Msg3]  â†’ Cache æ¡ç›® C (A, B ä»å­˜åœ¨)
...
Agent æ­¥éª¤ 20: [System][Tools][Msg1]...[Msg20]    â†’ Cache æ¡ç›® T (A-S å¯èƒ½ä»å­˜åœ¨)
```

å¦‚æœæ¯æ­¥é—´éš”ä¸åˆ° 5 åˆ†é’Ÿï¼Œ20 æ¡ Cache æ¡ç›®å¯èƒ½åŒæ—¶å­˜åœ¨äºæœåŠ¡ç«¯æ˜¾å­˜ä¸­ã€‚å†ä¹˜ä»¥æˆåƒä¸Šä¸‡çš„å¹¶å‘ç”¨æˆ·ï¼ŒæœåŠ¡ç«¯çš„ Cache å­˜å‚¨ç³»ç»Ÿæ‰¿å—ç€å·¨å¤§çš„å‹åŠ›ã€‚

å¦‚æœå› ä¸ºéç¡®å®šæ€§åºåˆ—åŒ–ï¼ˆå¦‚å‰é¢ JSON key æ’åºä¸ä¸€è‡´çš„ä¾‹å­ï¼‰ï¼ŒåŒä¸€ä¸ªç”¨æˆ·çš„åŒä¸€ä¸ªå¯¹è¯è¿˜å¯èƒ½äº§ç”Ÿå¤šæ¡è¯­ä¹‰å‡ ä¹ç›¸åŒä½†æ— æ³•äº’ç›¸å¤ç”¨çš„ Cache æ¡ç›®â€”â€”æ—¢æµªè´¹è®¡ç®—ï¼Œåˆæµªè´¹å­˜å‚¨ã€‚

### å¼€æºæ¨ç†å¼•æ“çš„ Cache ç®¡ç†

å•†ä¸š API çš„ Cache ç®¡ç†å¯¹å¼€å‘è€…æ˜¯é»‘ç›’ã€‚ä½†å¼€æºæ¨ç†å¼•æ“æä¾›äº†é€æ˜çš„å®ç°ï¼Œå¯ä»¥å¸®åŠ©ç†è§£åŸç†ï¼š

**vLLM çš„ Block çº§ç®¡ç†**ï¼švLLM æŠŠ KV Cache æŒ‰å›ºå®šå¤§å°çš„ block å­˜å‚¨ï¼ˆæ¯”å¦‚æ¯ 16 ä¸ª token ä¸€ä¸ª blockï¼‰ï¼Œç”¨ hash åšç´¢å¼•ã€‚ä¸åŒè¯·æ±‚å¦‚æœæœ‰å…±åŒå‰ç¼€ï¼Œå¯ä»¥åœ¨ block ç²’åº¦ä¸Šå…±äº«ï¼Œæ¯”"æ•´æ¡å‰ç¼€è¦ä¹ˆå…¨å‘½ä¸­è¦ä¹ˆå…¨ miss"æ›´é«˜æ•ˆï¼š

```
è¯·æ±‚ 1: [Block_A: "Under","standing",...] [Block_B: "KV"," Cache",...] [Block_C: ...]
è¯·æ±‚ 2: [Block_A: "Under","standing",...] [Block_B: "KV"," Cache",...] [Block_D: ...]
                                                                        â†‘ è¿™é‡Œå¼€å§‹ä¸åŒ
Block_A å’Œ Block_B è¢«ä¸¤ä¸ªè¯·æ±‚å…±äº«ï¼ŒBlock_C å’Œ Block_D å„è‡ªç‹¬ç«‹
```

**SGLang çš„ Radix Tree**ï¼šç”¨åŸºæ•°æ ‘ç®¡ç†å‰ç¼€ï¼Œå…±åŒå‰ç¼€åªå­˜ä¸€ä»½ï¼Œåˆ†å‰ç‚¹ä¹‹åå„å­˜å„çš„ï¼š

```
         [System Prompt]
            /        \
   [ç”¨æˆ·Açš„å¯¹è¯]    [ç”¨æˆ·Bçš„å¯¹è¯]
      / \                |
  [æ­¥éª¤2] [æ­¥éª¤2å˜ä½“]   [æ­¥éª¤2]
```

ä¸¤ç§æ–¹æ¡ˆéƒ½ä½¿ç”¨ LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç­–ç•¥ï¼Œåœ¨æ˜¾å­˜ä¸è¶³æ—¶æ·˜æ±°æœ€ä¹…æ²¡è¢«å‘½ä¸­çš„ Cache æ¡ç›®ã€‚

è¿™å¯¹ Agent å¼€å‘è€…çš„å¯ç¤ºæ˜¯ï¼š**åš Cache-Safe è®¾è®¡ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨å¸®æœåŠ¡ç«¯å‡å°‘æ— æ•ˆçš„ Cache æ¡ç›®ï¼Œæé«˜æ•´ä½“èµ„æºåˆ©ç”¨æ•ˆç‡ã€‚** Cache å‘½ä¸­ç‡è¶Šé«˜ï¼ŒæœåŠ¡ç«¯çš„æ˜¾å­˜æµªè´¹è¶Šå°‘ï¼Œä½ æ”¯ä»˜çš„ Cache Write æº¢ä»·ä¹Ÿè¶Šå€¼å¾—ã€‚

---

## è¿™æ¡çº¦æŸå¦‚ä½•æ”¹å˜ Agent æ¶æ„

**å‰ç¼€ç²¾ç¡®åŒ¹é…è¿™æ¡çº¦æŸï¼Œç›´æ¥å†³å®šäº† Agent çš„æ•´ä¸ªæ¶æ„è®¾è®¡ã€‚**

Claude Code å›¢é˜Ÿçš„ Thariq è¯´å¾—å¾ˆç›´ç™½ï¼šPrompt Cache ä¸åªæ˜¯ä¸€ä¸ªçœé’±æŠ€å·§ï¼Œå®ƒæ˜¯ Agent ç³»ç»Ÿæ¶æ„è®¾è®¡çš„æ ¸å¿ƒçº¦æŸã€‚å°±åƒæ•°æ®åº“çš„ Schema è®¾è®¡ä¼šå½±å“æ•´ä¸ªåº”ç”¨æ¶æ„ä¸€æ ·ï¼Œå‰ç¼€åŒ¹é…çº¦æŸæ·±åˆ»åœ°å½±å“äº† Agent çš„æ¯ä¸€ä¸ªè®¾è®¡å†³ç­–ã€‚

å…·ä½“æ¥è¯´ï¼š

- **Prompt æ€ä¹ˆç»„ç»‡ï¼Ÿ** â†’ ç¨³å®šå†…å®¹æ”¾å‰é¢ï¼Œå˜åŒ–å†…å®¹æ”¾åé¢
- **å·¥å…·æ€ä¹ˆç®¡ç†ï¼Ÿ** â†’ å·¥å…·åˆ—è¡¨å›ºå®šä¸å˜ï¼Œé€šè¿‡å…¶ä»–æœºåˆ¶é™åˆ¶å¯ç”¨èŒƒå›´
- **åŠ¨æ€ä¿¡æ¯æ€ä¹ˆæ›´æ–°ï¼Ÿ** â†’ æ°¸è¿œè¿½åŠ æ–°æ¶ˆæ¯ï¼Œæ°¸è¿œä¸ä¿®æ”¹æ—§æ¶ˆæ¯
- **æ¨¡å‹æ€ä¹ˆé€‰ï¼Ÿ** â†’ å•æ¬¡ä¼šè¯å†…ä¸åˆ‡æ¢æ¨¡å‹ï¼Œç”¨å­ä»£ç†éš”ç¦»

è¿™äº›è®¾è®¡åŸåˆ™ï¼Œä¸æ˜¯æŸä¸ªå›¢é˜Ÿçš„"æœ€ä½³å®è·µ"ï¼Œè€Œæ˜¯è¢«å‰ç¼€åŒ¹é…è¿™æ¡ç‰©ç†çº¦æŸ**é€¼å‡ºæ¥çš„**ã€‚Claude Codeã€Manusã€OpenAI Codex ä¸‰å®¶ç‹¬ç«‹æ¼”åŒ–ï¼Œæœ€ç»ˆæ®Šé€”åŒå½’ã€‚

---

## Prompt Caching åˆ°åº•æ˜¯ Agent å·¥ç¨‹è¿˜æ˜¯ LLM å·¥ç¨‹ï¼Ÿ

ç­”æ¡ˆæ˜¯ï¼š**ä¸¤è€…éƒ½æ˜¯ï¼Œä½†é‡å¿ƒåœ¨ Agent å·¥ç¨‹ã€‚**

| å±‚é¢ | å½’å± | è°è´Ÿè´£ |
|------|------|--------|
| KV Cache çš„å®ç° | LLM å·¥ç¨‹ | æ¨ç†å¼•æ“å¼€å‘è€…ï¼ˆvLLMã€SGLangï¼‰ |
| Prefix Caching çš„æœåŠ¡ç«¯å®ç° | LLM å·¥ç¨‹ | æ¨¡å‹æœåŠ¡æä¾›å•†ï¼ˆAnthropicã€OpenAIã€DeepSeekï¼‰ |
| **Prompt ç»“æ„è®¾è®¡ï¼ˆç¨³å®šå‰ç¼€ + å¯å˜åç¼€ï¼‰** | **Agent å·¥ç¨‹** | **ä½ ï¼ŒAgent æ¶æ„å¸ˆ** |
| **å·¥å…·åˆ—è¡¨çš„ Cache-Safe ç®¡ç†** | **Agent å·¥ç¨‹** | **ä½ ** |
| **ä¸Šä¸‹æ–‡å‹ç¼©ç­–ç•¥** | **Agent å·¥ç¨‹** | **ä½ ** |
| **å­ä»£ç†çš„ Cache å‹å¥½è®¾è®¡** | **Agent å·¥ç¨‹** | **ä½ ** |
| **åºåˆ—åŒ–çš„ç¡®å®šæ€§ä¿è¯** | **Agent å·¥ç¨‹** | **ä½ ** |

å¼€æºæ¨ç†å¼•æ“ä¹Ÿå·²ç»æ˜¯æ ‡é…â€”â€”vLLM é€šè¿‡ `--enable-prefix-caching` å¼€å¯ï¼ŒSGLang é»˜è®¤å¼€å¯ RadixAttentionã€‚æ— è®ºä½ ç”¨å¼€æºå¼•æ“è‡ªéƒ¨ç½²è¿˜æ˜¯è°ƒç”¨å•†ä¸š APIï¼ˆClaudeã€OpenAIã€DeepSeekï¼‰ï¼Œéƒ½å¯ä»¥è·å¾—è¿™ä¸ªä¼˜åŒ–ã€‚

ä¸€å¥è¯æ€»ç»“ï¼š

> **LLM å·¥ç¨‹å¸ˆæŠŠ Prompt Cache çš„èƒ½åŠ›é€ å¥½äº†ï¼Œä½†èƒ½ä¸èƒ½ç”¨ä¸Šã€ç”¨å¥½ï¼Œæ˜¯ Agent æ¶æ„å¸ˆçš„è´£ä»»ã€‚Cache-Safe æ˜¯ Client ä¾§å·¥ç¨‹ã€‚**

å¾ˆå¤šåš Agent å¼€å‘çš„åŒå­¦ï¼Œç”¨ç€ Claude API æˆ– OpenAI APIï¼ŒPrompt Cache é»˜è®¤å°±å¼€ç€ï¼Œä½†å› ä¸º Prompt ç»“æ„è®¾è®¡ä¸å½“ï¼ˆæ—¶é—´æˆ³æ”¾å¼€å¤´ã€åŠ¨æ€å¢åˆ å·¥å…·ã€éç¡®å®šæ€§åºåˆ—åŒ–ï¼‰ï¼ŒCache å‘½ä¸­ç‡å¯èƒ½ä½å¾—å¯æ€œâ€”â€”**ä½ ä»¥ä¸ºåœ¨çœé’±ï¼Œå…¶å®åœ¨çƒ§é’±**ã€‚

åˆ°åº•æ˜¯ä»€ä¹ˆåœ¨ç ´åä½ çš„ Cacheï¼Ÿä¸‹ä¸€ç¯‡æˆ‘ä»¬æ¥æ‹†è§£ Cache å‘½ä¸­ç‡çš„å…­å¤§æ€æ‰‹ï¼Œä»¥åŠ Claude Codeã€Manusã€OpenAI Codex å„è‡ªçš„åº”å¯¹æ–¹æ¡ˆï¼Œå¹¶åšä¸€æ¬¡å…¨è¡Œä¸šæ‰«æã€‚

---

> 1. **KV Cache æ˜¯å•æ¬¡è¯·æ±‚å†…çš„ä¼˜åŒ–ï¼ŒPrompt Cache æ˜¯è·¨è¯·æ±‚çš„ä¼˜åŒ–**â€”â€”è¿™ä¸ªè·ƒè¿æ˜¯ç†è§£ Agent æˆæœ¬æ§åˆ¶çš„å…³é”®ã€‚
>
> 2. **å‰ç¼€ç²¾ç¡®åŒ¹é…æ˜¯ç‰©ç†çº¦æŸ**ï¼Œä¸æ˜¯å»ºè®®ã€‚ä»»ä½•ä½ç½®çš„ä»»ä½• token å·®å¼‚éƒ½ä¼šç ´ååç»­ Cacheã€‚ä¸‰å®¶å¤´éƒ¨ Agent çš„æ¶æ„è®¾è®¡éƒ½å›´ç»•è¿™æ¡çº¦æŸå±•å¼€ã€‚
>
> 3. **Agent åœºæ™¯ä¸‹ï¼Œæ²¡æœ‰ Prompt Cache å°±æ²¡æœ‰å¯è¡Œçš„å•†ä¸šæ¨¡å‹**ã€‚100:1 çš„ I/O æ¯” + äºŒæ¬¡æ–¹æˆæœ¬å¢é•¿ = ä¸å¯æŒç»­ã€‚
>
> 4. **Cache-Safe æ˜¯ Client ä¾§å·¥ç¨‹è´£ä»»**ã€‚æ¨ç†å¼•æ“å·²ç»å‡†å¤‡å¥½äº†ï¼Œé—®é¢˜åœ¨äºä½ çš„ Agent ä»£ç æœ‰æ²¡æœ‰ä¸ºå®ƒåšè®¾è®¡ã€‚

---

**ã€ŒAgent å·¥ç¨‹å¸ˆçš„ Prompt Cachingã€ç³»åˆ—å¯¼èˆª**

1. [KV Cache åŸç†ï¼šLLM æ¨ç†çš„åº•å±‚æœºåˆ¶](/posts/prompt-caching-kv-cache-fundamentals/)
2. **Prompt Cacheï¼šAgent æˆæœ¬æ§åˆ¶çš„æ ¸å¿ƒçº¦æŸ**ï¼ˆæœ¬æ–‡ï¼‰
3. [Cache æ€æ‰‹ä¸è¡Œä¸šå®æˆ˜ï¼šä»è¸©å‘åˆ°æœ€ä½³å®è·µ](/posts/prompt-caching-killers-and-industry/)
4. [Context Engineeringï¼šAgent æ¶æ„å¸ˆçš„æ ¸å¿ƒæ‰‹è‰º](/posts/prompt-caching-context-engineering/)
